attributes:
  services:
    app:
      environment:
        LOG_LEVEL: debug
        APP_HOST: = @('hostname')
    mysql:
      version: 5.7
      environment:
        MYSQL_DATABASE: = @('database.name')
        MYSQL_PASSWORD: = @('database.pass')
        MYSQL_ROOT_PASSWORD: = @('database.root_pass')
        MYSQL_USER: = @('database.user')
    postgres:
      version: 9.6
      environment:
        POSTGRES_DB: = @('database.name')
        POSTGRES_PASSWORD: = @('database.pass')
        POSTGRES_USER: = @('database.user')
        PGDATA: /var/lib/postgresql/data/pgdata

  pipeline:
    publish:
      enabled: no
    preview:
      enabled: no
      namespace: = @('workspace.name') ~ '-' ~ slugify(branch())
      hostname:  = @('pipeline.preview.namespace') ~ '.example.com'
    base:
      resourcePrefix: ~
      hostname: = @('pipeline.base.namespace') ~ '.example.com'
      istio:
        gateways:
          - "istio-system/{{ .Release.Namespace }}-gateway"
      prometheus:
        podMonitoring: false
      services:
        app:
          environment:
            APP_HOST: = @('pipeline.base.hostname')
            LOG_LEVEL: info
          metricsEnabled: true
          metricsEndpoints:
            - port: = @('app.default_port.name')
    qa:
      enabled: no
      namespace: = @('workspace.name') 
      hostname: = @('pipeline.qa.namespace') ~ '.' ~ @('domain')
      resourcePrefix: ~
      services:
        app:
          environment:
            APP_HOST: = @('pipeline.qa.hostname')
