{% set blocks  = 'helm/app/_twig/values.yaml/' %}

docker:
  config: {{ @('docker.config') }}
  services:
{{ deep_merge_to_yaml([@('services'), @('pipeline.base.services')], 2, 4) | raw }}
  image:
    app: {{ @('docker.repository') ~ ':' ~ @('docker.tagPrefix') ~ @('app.version') }}

service:
  mysql: {{ ("mysql" in @('app.services')) ? 'true' : 'false' }}
  postgres: {{ ("postgres" in @('app.services')) ? 'true' : 'false' }}

persistence:
  mysql:
{{ to_yaml(@('persistence.mysql'), 2, 4) | raw }}
  postgres:
{{ to_yaml(@('persistence.postgres'), 2, 4) | raw }}

prometheus:
{{ to_yaml(@('pipeline.base.prometheus'), 2, 2) | raw }}

resources:
{% include blocks ~ 'resources.yml.twig' %}

default_port:
{{ to_yaml(@('app.default_port'), 2, 2) | raw }}
health_port: {{ @('app.health_port') }}
ingress:
{{ to_yaml(@('app.ingress'), 2, 2) | raw }}
istio:
{{ to_yaml(@('pipeline.base.istio'), 2, 2) | raw }}
resourcePrefix: {{ @('pipeline.base.resourcePrefix') | json_encode | raw }}

{% include blocks ~ 'additional.yml.twig' %}
