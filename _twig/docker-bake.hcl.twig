variable "PLATFORMS" {
    default = [
{% for platform in @('docker.production.platforms') %}
        "{{platform}}",
{% endfor %}
    ]
}

group "default" {
    targets = [
        "app",
    ]
}

target "app" {
    dockerfile = ".my127ws/docker/image/app/Dockerfile"
    target = "prod"
    platforms = PLATFORMS
    tags = [
        "{{ @('docker.repository') }}:{{ @('docker.tagPrefix') }}{{ @('app.version') }}"
{% for tag in @('docker.production.additional_tags') %}
        "{{ @('docker.repository') }}:{{ @('docker.tagPrefix') }}{{ tag }}"
{% endfor %}
    ]
}
